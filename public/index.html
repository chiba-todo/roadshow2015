<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Sensor Data Visualization</title>
    <link rel="stylesheet" type="text/css" href="heart.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/webticker.css">
	<script type="text/javascript" src="js/jquery.webticker.js"></script>
	<link rel="stylesheet" type="text/css" href="video.css">
	<script type="text/javascript" src="video.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi?autoload={
            'modules':[{
              'name':'visualization',
              'version':'1',
              'packages':['corechart']
            }]
          }"></script>
    
    <script type="text/javascript">

		$(document).ready( function(){      // HTMLが準備できたら接続する
			connect();
		});

      	var wsUrl = 'ws://arduino-20150721.mybluemix.net/ws/sensor';
              // WebSocketオブジェクト
        var webSocket = null;
      
//      var socket;
		var temperatureData, humidityData, illuminanceData, hoge1Data, hoge2Data;
		var temperatureOptions, humidityOptions, illuminanceOptions, hoge1Options, hoge2Options;
		var temperatureChart, humidityChart, illuminanceChart, hoge1Chart, hoge2Chart;

		var temperatureArrey = [['Time', 'Planz Factory']];
		var humidityArrey = [['Time', 'Planz Factory']];
		var illuminanceArrey = [['Time', 'Planz Factory']];
        var hoge1Arrey = [['Time', 'Planz Factory']];
        var hoge2Arrey = [['Time', 'Planz Factory']];



		var cont = 0;
      
      // Google Gauge
//      google.load("visualization", "1", {packages:["gauge"]});
      	google.setOnLoadCallback(drawChart);

      	function drawChart() {
        // Data for temperature chart
	        temperatureData = google.visualization.arrayToDataTable([
	          ['Time', 'Planz Factory'],
	          ['', 0]
	        ]);
        
        // Data for humidity chart
	        humidityData = google.visualization.arrayToDataTable([
	          ['Time', 'Planz Factory'],
	          ['', 0]
	        ]);

        // Data for illuminance chart
	        illuminanceData = google.visualization.arrayToDataTable([
	          ['Time', 'Planz Factory'],
	          ['', 0]
	        ]);

        // Data for illuminance chart
            hoge1Data = google.visualization.arrayToDataTable([
              ['Time', 'Planz Factory'],
              ['', 0]
            ]);

        // Data for illuminance chart
            hoge2Data = google.visualization.arrayToDataTable([
              ['Time', 'Planz Factory'],
              ['', 0]
            ]);
        

        // Option for temperature chart
        // If you want to set other options, please refer to https://developers.google.com/chart/interactive/docs/gallery/gauge
	        temperatureOptions = {
	          	title: '温度1',
                titleTextStyle: { fontName: "Hiragino Kaku Gothic ProN", fontSize: 20},
	          	width: 250, height: 150,
	          	curveType: 'function',
	          	legend: { position: 'right' },
	          // chartArea: {width: '300'}   // グラフ横幅（ピクセル）
	          	hAxis: {gridlines:{count:'5'},

	//          		showTextEvery: 10,
	          		slantedText: true,  // 横軸の目盛テキストを斜めに表示
	          							// （データ数が多いときは文字が重ならないように自動的に間引かれる）
	          		slantedTextAngle: '30',  // 横軸の目盛テキストの角度
	      		},
				chartArea:{left:50,top:40,width:'70%',height:'60%',fontSize:20},
	        };
	        
	        // Option for humidity chart
	        humidityOptions = {
	          	title: '温度2',
                titleTextStyle: { fontName: "Hiragino Kaku Gothic ProN", fontSize: 20},
	          	width: 250, height: 150,
	          	curveType: 'function',
	          	legend: { position: 'right' },
	          	hAxis: {gridlines:{count:'5'},
	          		slantedText: true,  // 横軸の目盛テキストを斜めに表示
	          		slantedTextAngle: '30',  // 横軸の目盛テキストの角度
	      		},
				chartArea:{left:50,top:40,width:'70%',height:'60%'},
	        };

	        // Option for humidity chart
	        illuminanceOptions = {
	          	title: '明るさ',
                titleTextStyle: { fontName: "Hiragino Kaku Gothic ProN", fontSize: 20},
	          	width: 250, height: 150,
	          	curveType: 'function',
	          	legend: { position: 'right' },
	          	hAxis: {gridlines:{count:'5'},
	          		slantedText: true,  // 横軸の目盛テキストを斜めに表示
	          		slantedTextAngle: '30',  // 横軸の目盛テキストの角度
	      		},
				chartArea:{left:50,top:40,width:'70%',height:'60%'},
	        };

            // Option for humidity chart
            hoge1Options = {
                title: '生体反応1',
                titleTextStyle: { fontName: "Hiragino Kaku Gothic ProN", fontSize: 20},
                width: 250, height: 150,
                curveType: 'function',
                legend: { position: 'right' },
                hAxis: {gridlines:{count:'5'},
                    slantedText: true,  // 横軸の目盛テキストを斜めに表示
                    slantedTextAngle: '30',  // 横軸の目盛テキストの角度
                },
                chartArea:{left:50,top:40,width:'70%',height:'60%'},
            };

            // Option for humidity chart
            hoge2Options = {
                title: '生体反応2',
                titleTextStyle: { fontName: "Hiragino Kaku Gothic ProN", fontSize: 20},
                width: 250, height: 150,
                curveType: 'function',
                legend: { position: 'right' },
                hAxis: {gridlines:{count:'5'},
                    slantedText: true,  // 横軸の目盛テキストを斜めに表示
                    slantedTextAngle: '30',  // 横軸の目盛テキストの角度
                },
                chartArea:{left:50,top:40,width:'70%',height:'60%'},
            };
        
	        temperatureChart = new google.visualization.LineChart(document.getElementById('temperatureChart'));
	        humidityChart = new google.visualization.LineChart(document.getElementById('humidityChart'));
	        illuminanceChart = new google.visualization.LineChart(document.getElementById('illuminanceChart'));
            hoge1Chart = new google.visualization.LineChart(document.getElementById('hoge1Chart'));
            hoge2Chart = new google.visualization.LineChart(document.getElementById('hoge2Chart'));

	        temperatureChart.draw(temperatureData, temperatureOptions);
	        humidityChart.draw(humidityData, humidityOptions);
	        illuminanceChart.draw(illuminanceData, illuminanceOptions);
            hoge1Chart.draw(hoge1Data, hoge1Options);
            hoge2Chart.draw(hoge2Data, hoge2Options);

        };

      	function connect() {

           	if (webSocket == null) {
				// WebSocket の初期化
				webSocket = new WebSocket(wsUrl);
				// イベントハンドラの設定
				//                webSocket.onopen = onOpen;
				webSocket.onmessage = onMessage;
				webSocket.onclose = onClose;
			    webSocket.onerror = onError;
            }
        }


        function onMessage(event) {

	        var sensorData = JSON.parse(event.data);
	        // console.log(event.data);
	        // console.log(sensorData); 
	// {"Timestamp":"2015-07-24 04:46:22","Temperature":32.8,"Humidity":66.2,"Lux":437}

			// Update temperature data
	        console.log(cont); 
	        // 配列に入力データを追加
	        temperatureArrey.push([sensorData.Timestamp, sensorData.Temperature]);
	        // 配列をグラフ用オブジェクトに変換
	        temperatureData = google.visualization.arrayToDataTable(temperatureArrey);
			// グラフタイトルの編集（最新と最古のタイムスタンプを表示する）
			temperatureOptions.title = "Temperature  " +  temperatureArrey[1][0] + " - " +  temperatureArrey[ temperatureArrey.length - 1][0];
			// 横軸テキストの表示間隔は、データ数が増えても５つくらいに
			temperatureOptions.hAxis.showTextEvery = parseInt(temperatureArrey.length / 5);

			// Update temperature data
	        humidityArrey.push([sensorData.Timestamp, sensorData.Humidity]);
	        humidityData = google.visualization.arrayToDataTable(humidityArrey);
			humidityOptions.title = "Humidity  " +  humidityArrey[1][0] + " - " +  humidityArrey[humidityArrey.length - 1][0];
			humidityOptions.hAxis.showTextEvery = parseInt(humidityArrey.length / 5);

			// Update temperature data
	        illuminanceArrey.push([sensorData.Timestamp, sensorData.Lux]);
	        illuminanceData = google.visualization.arrayToDataTable(illuminanceArrey);
			illuminanceOptions.title = "Illuminance  " +  illuminanceArrey[1][0] + " - " +  illuminanceArrey[illuminanceArrey.length - 1][0];
			illuminanceOptions.hAxis.showTextEvery = parseInt(illuminanceArrey.length / 5);
          
                        // Update temperature data
            hoge1Arrey.push([sensorData.Timestamp, sensorData.Lux]);
            hoge1Data = google.visualization.arrayToDataTable(hoge1Arrey);
            hoge1Options.title = "Illuminance  " +  hoge1Arrey[1][0] + " - " +  hoge1Arrey[hoge1Arrey.length - 1][0];
            hoge1Options.hAxis.showTextEvery = parseInt(hoge1Arrey.length / 5);

                        // Update temperature data
            hoge2Arrey.push([sensorData.Timestamp, sensorData.Lux]);
            hoge2Data = google.visualization.arrayToDataTable(hoge1Arrey);
            hoge2Options.title = "Illuminance  " +  hoge2Arrey[1][0] + " - " +  hoge2Arrey[hoge2Arrey.length - 1][0];
            hoge2Options.hAxis.showTextEvery = parseInt(hoge2Arrey.length / 5);

			temperatureChart.draw(temperatureData, temperatureOptions);
			humidityChart.draw(humidityData, humidityOptions);
			illuminanceChart.draw(illuminanceData, illuminanceOptions);
            hoge1Chart.draw(hoge1Data, hoge1Options);
            hoge2Chart.draw(hoge2Data, hoge2Options);

          	cont++;
        }

      
        function onError(event) {
        	console.log(event.data);  
        }

        function onClose(event) {
        	console.log(event.code);  
            webSocket = null;    // 勝手に接続が切れることがあるので、自動再接続する
            connect();
        }
        
    </script>
  </head>
  <body>
<!--     <h1>Information from Weather Monitor</h1>
 -->    <div>
      <!-- <button onclick="connect()">Connect</button> -->
      <!-- <button onclick="disconnect()">Disconnect</button> -->
    </div>
    <ul id="webticker">
        <li>わたし、生きてまーす。</li>
        <li>ちゃんと息してまーす。</li>
    </ul>
    <div class="heart heart1"></div>
	<div class="heart heart2"></div>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    <div id="chartList">
        <div id="temperatureChart" class="opacity" style="width: 250px; height: 150px; float: left;"></div>
        <div id="humidityChart" class="opacity" style="width: 250px; height: 150px; float: left;"></div>
        <div id="illuminanceChart" class="opacity" style="width: 250px; height: 150px; float: left;"></div>
        <div id="hoge1Chart" class="opacity" style="width: 250px; height: 150px; float: left;"></div>
        <div id="hoge2Chart" class="opacity" style="width: 250px; height: 150px; float: left;"></div>
    </div>


  </body>
</html>